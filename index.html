<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Latest Tweets (List)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="refresh" content="120" />
  <style>
    :root { --text:#0f172a; --muted:#64748b; --link:#0366d6; --rule:#e5e7eb; }
    html,body{margin:0;padding:0;font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--text)}
    header{padding:12px 16px;border-bottom:1px solid var(--rule)}
    h1{margin:0 0 8px 0;font-weight:700}
    .wrap{max-width:980px;margin:0 auto;padding:16px}
    .note{color:var(--muted);margin:8px 0 16px}
    .timeline{min-height:80vh}
    a{color:var(--link);text-decoration:none} a:hover{text-decoration:underline}
    .list-card{border-bottom:1px solid var(--rule);padding:12px 0}
    .meta{color:var(--muted);font-size:12px;margin-bottom:6px}
    pre{white-space:pre-wrap}
  </style>
</head>
<body>
  <header class="wrap">
    <h1>Latest tweets from my List</h1>
    <div class="note">This view refreshes every 2 minutes.</div>
  </header>

  <main class="wrap timeline">
    <div id="embed">
      <a class="twitter-timeline"
         data-theme="light"
         data-chrome="nofooter noborders"
         data-width="100%"
         data-height="900"
         href="https://twitter.com/i/lists/1955671831572029854">
        Tweets from my List
      </a>
    </div>

    <div id="fallback" style="display:none">
      <div class="note">Embed blocked or unavailable — showing recent posts (24h).</div>
      <div id="feed"></div>
    </div>
  </main>

  <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
  <script>
    function embedRendered() {
      return document.querySelector('#embed iframe');
    }

    async function loadJSONFallback() {
      try {
        const r = await fetch('tweets.json', { cache: 'no-store' });
        if (!r.ok) throw new Error('tweets.json not found');
        const j = await r.json();

        const feed = document.getElementById('feed');
        const out = [];
        const items = (j.items || []).slice(0, 120);

        for (const t of items) {
          const text = (t.text || '')
            .replace(/&/g,'&amp;').replace(/</g,'&lt;');
          const when = t.created_at ? new Date(t.created_at).toLocaleString() : '';
          out.push(
            `<div class="list-card">
               <div class="meta">@${t.account} · ${when}</div>
               <div>${text}</div>
               <div class="meta"><a target="_blank" rel="noopener" href="${t.url}">OOpen on X</a></div>
             </div>X
          );
        }
        feed.innerHTML = out.join('') || '<div class="note">No recent posts.</div>';

        document.getElementById('embed').style.display = 'none';
        document.getElementById('fallback').style.display = '';
      } catch (e) {
        console.warn('Fallback failed:', e);
      }
    }

    (function decide() {
      const start = Date.now();
      const tick = setInterval(() => {
        if (embedRendered()) { clearInterval(tick); return; }
        if (Date.now() - start > 3200) { clearInterval(tick); loadJSONFallback(); }
      }, 150);
      setTimeout(() => { if (!embedRendered()) loadJSONFallback(); }, 3500);
    })();
  </script>
</body>
</html>
